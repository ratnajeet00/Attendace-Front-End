<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="vendors/linericon/style.css">
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="vendors/owl-carousel/owl.carousel.min.css">
    <link rel="stylesheet" href="vendors/lightbox/simpleLightbox.css">
    <link rel="stylesheet" href="vendors/nice-select/css/nice-select.css">
    <link rel="stylesheet" href="vendors/animate-css/animate.css">
    <link rel="stylesheet" href="vendors/popup/magnific-popup.css">
    <link rel="stylesheet" href="vendors/flaticon/flaticon.css">
    <!-- main css -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>

<body>

    <!--================Header Menu Area =================-->
    <header class="header_area">
        <div class="main_menu">
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="container box_1620">
                    <!-- Brand and toggle get grouped for better mobile display -->



                </div>
            </nav>
        </div>
    </header>
    <!--================Header Menu Area =================-->



    <!--================Welcome Area =================-->
    <section class="welcome_area p_120">
        <div class="container">
            <div class="row welcome_inner">
                <div class="col-lg-6">
                    <div class="welcome_text">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="wel_item"> <i class="lnr lnr-book"></i>
                                    <h5>Days Attended</h5><br>
                                    <p>
                                    <h5 id="daysAttended"></h5>
                                    </p>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="wel_item"> <i class="lnr lnr-book"></i>
                                    <h5>Days Absent</h5><br>
                                    <p>
                                    <h5 id="daysAbsent"></h5>
                                    </p>

                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="wel_item"> <i class="lnr lnr-book"></i>
                                    <h5>Total School Days</h5><br>
                                    <p>
                                    <h5 id="totalSchoolDays"></h5>
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="tools_expert">
                        <div class="skill_main">
                            <div class="skill_item">
                                <h4>Days Present Percentage <span class="counter" id="daysPresentPercentage"></span>%
                                </h4>
                                <div class="progress_br">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" aria-valuenow="0" aria-valuemin="0"
                                            aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
    <!--================End Welcome Area =================-->

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/popper.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/stellar.js"></script>
    <script src="vendors/lightbox/simpleLightbox.min.js"></script>
    <script src="vendors/nice-select/js/jquery.nice-select.min.js"></script>
    <script src="vendors/isotope/imagesloaded.pkgd.min.js"></script>
    <script src="vendors/isotope/isotope.pkgd.min.js"></script>
    <script src="vendors/owl-carousel/owl.carousel.min.js"></script>
    <script src="vendors/popup/jquery.magnific-popup.min.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="vendors/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendors/counter-up/jquery.counterup.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/theme.js"></script>

    <!-- ... previous HTML code ... -->



    <header class="header_area">
        <div class="main_menu">
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="container box_1620">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <img src="img/profile.png" alt="Avatar" class="avatar">
                    </button>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse offset" id="navbarSupportedContent">
                        <ul class="nav navbar-nav menu_nav ml-auto">
                            <li class="nav-item dropdown">
                                <a class="nav-link circular-link dropdown-toggle" href="#" id="navbarDropdown"
                                    role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <div class="user-info">
                                        <img src="img/profile.png" alt="Avatar" class="avatar">
                                        <span>Username</span> <!-- Replace with actual username -->
                                    </div>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                    <a class="dropdown-item" href="#" onclick="logoutAndRedirect()">Logout</a>
                                </div>
                            </li>
                        </ul>
                    </div>

                    <style>
                        .avatar {
                            vertical-align: middle;
                            width: 50px;
                            height: 50px;
                            border-radius: 50%;


                            .header_area .navbar-nav .dropdown-menu .user-info {
                                display: flex;
                                align-items: center;
                            }

                            .header_area .navbar-nav .circular-link.dropdown-toggle {
                                cursor: pointer;
                            }

                            .header_area .navbar-nav .circular-link.dropdown-toggle::after {
                                display: inline-block;
                                margin-left: 0.255em;
                                vertical-align: 0.255em;
                                content: '';
                                border-top: 0.3em solid;
                                border-right: 0.3em solid transparent;
                                border-bottom: 0;
                                border-left: 0.3em solid transparent;
                            }

                            .header_area .navbar-nav .dropdown-menu {
                                border-radius: 0;
                                background-color: #3498db;
                                right: 0;
                                /* Adjust the position from the right edge */
                            }

                            .header_area .navbar-nav .dropdown-menu .dropdown-item {
                                color: #fff;
                            }

                            .header_area .navbar-nav .dropdown-menu .dropdown-item:hover {
                                background-color: #2980b9;
                            }

                            .header_area .navbar-nav .nav-item {
                                margin-right: 20px;
                                /* Adjust the spacing between circular links */
                            }

                            .header_area .navbar-nav .circular-link {
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                width: 40px;
                                /* Set the desired width for the circular links */
                                height: 40px;
                                /* Set the desired height for the circular links */
                                background-color: #3498db;
                                /* Set the desired background color for the circular links */
                                color: #fff;
                                /* Set the desired text color for the circular links */
                                border-radius: 50%;
                                /* Make it circular */
                                text-decoration: none;
                                transition: background-color 0.3s;
                            }

                            .header_area .navbar-nav .circular-link:hover {
                                background-color: #2980b9;
                                /* Set the desired background color on hover */
                            }

                            .header_area .navbar-nav .circular-link img {
                                max-width: 70%;
                                /* Set the desired size for the icons inside the circular links */
                            }
                    </style>

                </div>
            </nav>
        </div>
    </header>
    <!-- ... previous HTML code ... -->

    <script>
        window.onload = function () {
            // Retrieve user ID from the cookie
            const userId = getCookie('username');
            const isLoggedIn = getCookie('isLoggedIn') === 'true';

            if (userId && isLoggedIn) {
                // Fetch attendance data from the server using POST
                fetch('https://vulture-on-treefrog.ngrok-free.app/attendance-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ userId: userId }),
                })
                    .then(response => response.json())
                    .then(data => {
                        // Check if necessary data is available
                        if (data.daysPresent !== undefined && data.daysAbsent !== undefined) {
                            // Calculate total school days
                            const totalSchoolDays = data.daysPresent + data.daysAbsent;

                            // Calculate days present percentage
                            const daysPresentPercentage = (data.daysPresent / totalSchoolDays) * 100;

                            // Update elements for days present and days absent
                            $("#daysAttended").text(data.daysPresent);
                            $("#daysAbsent").text(data.daysAbsent);

                            // Update elements for total school days and days present percentage
                            $("#totalSchoolDays").text(totalSchoolDays.toFixed(0)); // Round to the nearest whole number
                            $("#daysPresentPercentage").text(daysPresentPercentage.toFixed(2)); // Round to two decimal places

                            // Update progress bar width based on days present percentage
                            $(".progress-bar").css("width", `${daysPresentPercentage}%`);
                        } else {
                            console.error('Days present or days absent data not available');
                        }
                    })
                    .catch(error => console.error('Error fetching attendance data:', error));
            } else {
                console.error('User ID not found in the cookie or user not logged in');
            }
        };

        // Function to get the value of a cookie by name
        function getCookie(cookieName) {
            const name = `${cookieName}=`;
            const decodedCookie = decodeURIComponent(document.cookie);
            const cookieArray = decodedCookie.split(';');

            for (let i = 0; i < cookieArray.length; i++) {
                let cookie = cookieArray[i].trim();
                if (cookie.indexOf(name) === 0) {
                    return cookie.substring(name.length, cookie.length);
                }
            }

            return null;
        }

        function logoutAndRedirect() {
            // Set the 'isLoggedIn' cookie to false
            document.cookie = "isLoggedIn=false; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

            // Delete the 'username' cookie
            document.cookie = "username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";

            // Redirect to the main index.html
            window.location.href = '../index.html';
        }
        function checkLoggedInStatus() {
            // Retrieve the value of the 'isLoggedIn' cookie
            const isLoggedIn = getCookie('isLoggedIn');

            // Check if 'isLoggedIn' is false or not present
            if (isLoggedIn === null || isLoggedIn.toLowerCase() !== 'true') {
                // Redirect to the main index.html
                window.location.replace('../index.html');
            }
        }
        checkLoggedInStatus();

        // Set interval to check the login status every 5 seconds (5000 milliseconds)
        setInterval(checkLoggedInStatus, 5000);
    </script>


    <!-- ... remaining HTML code ... -->


    <!-- ... remaining HTML code ... -->


    <!-- ... remaining HTML code ... -->

</body>

</html>